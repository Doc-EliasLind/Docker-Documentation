FROM kalilinux/kali-rolling

# Set noninteractive environment to skip configuration prompts and set user for tightvncserver
ENV DEBIAN_FRONTEND=noninteractive
ENV USER=root

# Update system, install essential utilities, pentesting tools, VNC, and minimal GUI environment
RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
        sudo \
        curl \
        wget \
        git \
        vim \
        nano \
        unzip \
        net-tools \
        iputils-ping \
        dnsutils \
        lsof \
        procps \
        tmux \
        python3 \
        python3-pip \
        man-db \
        nmap \
        netcat-openbsd \
        sqlmap \
        hydra \
        nikto \
        metasploit-framework \
        john \
        hashcat \
        aircrack-ng \
        wireshark \
        tcpdump \
        burpsuite \
        gobuster \
        dirb \
        ftp \
        ssh \
        openssl \
        openjdk-11-jre \
        xfce4 \
        xfce4-terminal \
        tightvncserver && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Create a startup script for updating packages
RUN echo '#!/bin/bash\napt-get update && apt-get upgrade -y\nexec "$@"' > /usr/local/bin/startup.sh && \
    chmod +x /usr/local/bin/startup.sh

# Set entrypoint to startup script
ENTRYPOINT ["/usr/local/bin/startup.sh"]

# Optional: Add VNC start command for convenience
CMD ["tightvncserver", ":1"]